<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #a7c598; -webkit-text-stroke: #a7c598}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s8 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s9 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s10 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s13 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s14 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Flat Rate VAT Calculator (10.5%)</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Load Tailwind CSS --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Use Inter font --&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">@import</span><span class="s4"> </span><span class="s5">url</span><span class="s8">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s9">'Inter'</span><span class="s8">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #f4f7f9</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.container-card</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #ffffff</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">1rem</span><span class="s8">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s4"> </span><span class="s1">0</span><span class="s4"> </span><span class="s1">10px</span><span class="s4"> </span><span class="s1">15px</span><span class="s4"> </span><span class="s1">-3px</span><span class="s4"> </span><span class="s5">rgba(</span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0.1</span><span class="s5">)</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s4"> </span><span class="s1">4px</span><span class="s4"> </span><span class="s1">6px</span><span class="s4"> </span><span class="s1">-2px</span><span class="s4"> </span><span class="s5">rgba(</span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0.05</span><span class="s5">)</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">1.5rem</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.input-style</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s10">1px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #d1d5db</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">0.5rem</span><span class="s1"> </span><span class="s10">1rem</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">0.5rem</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s10">100%</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s1"> </span><span class="s5">all</span><span class="s1"> </span><span class="s10">0.2s</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.input-style:focus</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">outline:</span><span class="s1"> </span><span class="s5">none</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-color:</span><span class="s1"> #3b82f6</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s10">0</span><span class="s1"> </span><span class="s10">0</span><span class="s1"> </span><span class="s10">0</span><span class="s1"> </span><span class="s10">3px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s10">59</span><span class="s8">,</span><span class="s1"> </span><span class="s10">130</span><span class="s8">,</span><span class="s1"> </span><span class="s10">246</span><span class="s8">,</span><span class="s1"> </span><span class="s10">0.5</span><span class="s5">)</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #2563eb</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s5">white</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">0.75rem</span><span class="s1"> </span><span class="s10">1.5rem</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">0.5rem</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s10">600</span><span class="s8">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s10">0.2s</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">cursor:</span><span class="s1"> </span><span class="s5">pointer</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary:hover</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #1d4ed8</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.summary-box</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #eff6ff</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-left:</span><span class="s1"> </span><span class="s10">4px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #3b82f6</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">1rem</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">0.5rem</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.filter-btn</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">0.5rem</span><span class="s1"> </span><span class="s10">1rem</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">0.5rem</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s10">500</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s10">1px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #d1d5db</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s1"> </span><span class="s5">all</span><span class="s1"> </span><span class="s10">0.2s</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">min-width:</span><span class="s4"> </span><span class="s10">80px</span><span class="s8">;</span><span class="s4"> </span><span class="s1">/* Ensure buttons are stable */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.filter-btn.active</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #3b82f6</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s5">white</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-color:</span><span class="s1"> #3b82f6</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Firebase SDKs --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> initializeApp </span><span class="s8">}</span><span class="s4"> </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getAuth</span><span class="s8">,</span><span class="s1"> signInAnonymously</span><span class="s8">,</span><span class="s1"> signInWithCustomToken</span><span class="s8">,</span><span class="s1"> onAuthStateChanged </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getFirestore</span><span class="s8">,</span><span class="s1"> doc</span><span class="s8">,</span><span class="s1"> addDoc</span><span class="s8">,</span><span class="s1"> onSnapshot</span><span class="s8">,</span><span class="s1"> collection</span><span class="s8">,</span><span class="s1"> query</span><span class="s8">,</span><span class="s1"> where</span><span class="s8">,</span><span class="s1"> serverTimestamp</span><span class="s8">,</span><span class="s1"> setLogLevel </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Global variables provided by the environment</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> appId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __app_id </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __app_id </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'default-app-id'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> firebaseConfig </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __firebase_config </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">parse</span><span class="s8">(</span><span class="s1">__firebase_config</span><span class="s8">)</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> initialAuthToken </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __initial_auth_token </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __initial_auth_token </span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> db</span><span class="s8">,</span><span class="s1"> auth</span><span class="s8">,</span><span class="s1"> userId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> vatRecordsRef</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- IMPORTANT: GOOGLE APPS SCRIPT WEB APP URL ---</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// This is the URL to your deployed Google Apps Script for Google Sheet integration.</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> </span><span class="s12">GOOGLE_SHEET_API_URL</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s1">"https://script.google.com/macros/s/AKfycbzKhb2h7gqPBb0FTHbOWUZV603sceaXKqA80LJuBHWryJbSz9IU6JIYMc_jCwRHSPhR/exec"</span><span class="s8">;</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --------------------------------------------------</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span>setLogLevel</span><span class="s8">(</span><span class="s9">'debug'</span><span class="s8">);</span><span class="s4"> </span><span class="s1">// Enable Firestore logging</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Utility function to determine the start and end dates for filtering</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* based on a chosen filter type and a reference date.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> getDateRange </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">filter</span><span class="s8">,</span><span class="s1"> dateString </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Use the provided date string or fall back to the current date</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> refDate </span><span class="s8">=</span><span class="s1"> dateString </span><span class="s8">?</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">dateString</span><span class="s8">)</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> now </span><span class="s8">=</span><span class="s1"> refDate</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> startDate </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">now</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> endDate </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">now</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Reset time for accurate date comparisons</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> resetTime </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">date</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">date</span><span class="s8">.</span><span class="s1">getFullYear</span><span class="s8">(),</span><span class="s1"> date</span><span class="s8">.</span><span class="s1">getMonth</span><span class="s8">(),</span><span class="s1"> date</span><span class="s8">.</span><span class="s1">getDate</span><span class="s8">());</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">switch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">filter</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s9">'daily'</span><span class="s8">:</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>startDate </span><span class="s8">=</span><span class="s1"> resetTime</span><span class="s8">(</span><span class="s1">now</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>endDate </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">startDate</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>endDate</span><span class="s8">.</span><span class="s1">setDate</span><span class="s8">(</span><span class="s1">endDate</span><span class="s8">.</span><span class="s1">getDate</span><span class="s8">()</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s14">1</span><span class="s8">);</span><span class="s1"> </span><span class="s13">// End of today</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s9">'weekly'</span><span class="s8">:</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Calculate start of the week (Monday) relative to the reference date</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> day </span><span class="s8">=</span><span class="s1"> now</span><span class="s8">.</span><span class="s1">getDay</span><span class="s8">()</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s14">7</span><span class="s8">;</span><span class="s1"> </span><span class="s13">// Get day number, make Sunday 7</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>startDate</span><span class="s8">.</span><span class="s1">setDate</span><span class="s8">(</span><span class="s1">now</span><span class="s8">.</span><span class="s1">getDate</span><span class="s8">()</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> day </span><span class="s8">+</span><span class="s1"> </span><span class="s14">1</span><span class="s8">);</span><span class="s1"> </span><span class="s13">// Go back to Monday</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>startDate </span><span class="s8">=</span><span class="s1"> resetTime</span><span class="s8">(</span><span class="s1">startDate</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>endDate </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">startDate</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>endDate</span><span class="s8">.</span><span class="s1">setDate</span><span class="s8">(</span><span class="s1">endDate</span><span class="s8">.</span><span class="s1">getDate</span><span class="s8">()</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s14">7</span><span class="s8">);</span><span class="s1"> </span><span class="s13">// End of next Sunday</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s9">'monthly'</span><span class="s8">:</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>startDate </span><span class="s8">=</span><span class="s1"> resetTime</span><span class="s8">(</span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">now</span><span class="s8">.</span><span class="s1">getFullYear</span><span class="s8">(),</span><span class="s1"> now</span><span class="s8">.</span><span class="s1">getMonth</span><span class="s8">(),</span><span class="s1"> </span><span class="s14">1</span><span class="s8">));</span><span class="s1"> </span><span class="s13">// Start of the month</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>endDate </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">now</span><span class="s8">.</span><span class="s1">getFullYear</span><span class="s8">(),</span><span class="s1"> now</span><span class="s8">.</span><span class="s1">getMonth</span><span class="s8">()</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s14">1</span><span class="s8">,</span><span class="s1"> </span><span class="s14">1</span><span class="s8">);</span><span class="s1"> </span><span class="s13">// Start of next month</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s9">'yearly'</span><span class="s8">:</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>startDate </span><span class="s8">=</span><span class="s1"> resetTime</span><span class="s8">(</span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">now</span><span class="s8">.</span><span class="s1">getFullYear</span><span class="s8">(),</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">1</span><span class="s8">));</span><span class="s1"> </span><span class="s13">// Start of the year</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>endDate </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">now</span><span class="s8">.</span><span class="s1">getFullYear</span><span class="s8">()</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s14">1</span><span class="s8">,</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">1</span><span class="s8">);</span><span class="s1"> </span><span class="s13">// Start of next year</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> startDate</span><span class="s8">,</span><span class="s1"> endDate </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Core Application Functions ---</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">initFirebase </span><span class="s8">=</span><span class="s1"> </span><span class="s7">async</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">Object</span><span class="s8">.</span><span class="s1">keys</span><span class="s8">(</span><span class="s1">firebaseConfig</span><span class="s8">).</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s14">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s4">error</span><span class="s8">(</span><span class="s1">"Firebase config is missing. Data persistence will not work."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> app </span><span class="s8">=</span><span class="s1"> initializeApp</span><span class="s8">(</span><span class="s1">firebaseConfig</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>auth </span><span class="s8">=</span><span class="s1"> getAuth</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>db </span><span class="s8">=</span><span class="s1"> getFirestore</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Authenticate using the provided custom token or anonymously</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">initialAuthToken</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> signInWithCustomToken</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">,</span><span class="s1"> initialAuthToken</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> signInAnonymously</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>onAuthStateChanged</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">user</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">user</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>userId </span><span class="s8">=</span><span class="s1"> user</span><span class="s8">.</span><span class="s1">uid</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'user-id'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`User ID: </span><span class="s8">${</span><span class="s1">userId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>vatRecordsRef </span><span class="s8">=</span><span class="s1"> collection</span><span class="s8">(</span><span class="s1">db</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`artifacts/</span><span class="s8">${</span><span class="s1">appId</span><span class="s8">}</span><span class="s9">/users/</span><span class="s8">${</span><span class="s1">userId</span><span class="s8">}</span><span class="s9">/vat_records`</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>console</span><span class="s8">.</span><span class="s4">log</span><span class="s8">(</span><span class="s1">"Firebase initialized and user authenticated:"</span><span class="s8">,</span><span class="s4"> userId</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s1">// Set the default filter date to today</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> today </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">().</span><span class="s1">toISOString</span><span class="s8">().</span><span class="s1">split</span><span class="s8">(</span><span class="s9">'T'</span><span class="s8">)[</span><span class="s14">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> filterDateInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'filterDate'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">filterDateInput</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>filterDateInput</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> today</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s1">// Set up initial listener after successful auth</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>window</span><span class="s8">.</span><span class="s1">setupRealtimeListener</span><span class="s8">(</span><span class="s9">'monthly'</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>console</span><span class="s8">.</span><span class="s4">log</span><span class="s8">(</span><span class="s1">"User signed out or anonymous sign-in failed."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s4">error</span><span class="s8">(</span><span class="s1">"Firebase Initialization or Auth Error:"</span><span class="s8">,</span><span class="s4"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Function to push data to Google Sheets via Apps Script</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> pushToGoogleSheet </span><span class="s8">=</span><span class="s1"> </span><span class="s7">async</span><span class="s1"> </span><span class="s8">(</span><span class="s1">invoiceData</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s4"> </span><span class="s8">(!</span><span class="s1">GOOGLE_SHEET_API_URL</span><span class="s4"> </span><span class="s8">||</span><span class="s4"> </span><span class="s1">GOOGLE_SHEET_API_URL</span><span class="s4"> </span><span class="s8">===</span><span class="s4"> </span><span class="s9">"YOUR_APPS_SCRIPT_WEB_APP_URL_HERE"</span><span class="s8">)</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s4">warn</span><span class="s8">(</span><span class="s1">"Google Sheet API URL is not set. Data not sent to Sheet."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Implementing a simple retry mechanism with exponential backoff</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> maxRetries </span><span class="s8">=</span><span class="s1"> </span><span class="s14">3</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">for</span><span class="s1"> </span><span class="s8">(</span><span class="s7">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&lt;</span><span class="s1"> maxRetries</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> response </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> fetch</span><span class="s8">(</span><span class="s12">GOOGLE_SHEET_API_URL</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>method</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'POST'</span><span class="s8">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                        </span>mode</span><span class="s8">:</span><span class="s4"> </span><span class="s9">'no-cors'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">// Apps Script requires 'no-cors' for simplicity</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>headers</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s1">'Content-Type'</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'application/json'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>body</span><span class="s8">:</span><span class="s1"> </span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">stringify</span><span class="s8">(</span><span class="s1">invoiceData</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// In 'no-cors' mode, we can't reliably check the status.<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// We assume success unless an underlying network error occurred.</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span>console</span><span class="s8">.</span><span class="s4">log</span><span class="s8">(</span><span class="s1">`Attempted to send data to Google Sheet (Try </span><span class="s8">${</span><span class="s4">i </span><span class="s8">+</span><span class="s4"> </span><span class="s14">1</span><span class="s8">}</span><span class="s1">).`</span><span class="s8">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Exit on successful request attempt (even if response status is unknown)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s4">error</span><span class="s8">(</span><span class="s1">"Error sending data to Google Sheet API after retries:"</span><span class="s8">,</span><span class="s4"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Called when a new invoice is submitted</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">saveInvoice </span><span class="s8">=</span><span class="s1"> </span><span class="s7">async</span><span class="s1"> </span><span class="s8">(</span><span class="s1">event</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>event</span><span class="s8">.</span><span class="s1">preventDefault</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">userId </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">vatRecordsRef</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s4">getElementById</span><span class="s8">(</span><span class="s1">'status-message'</span><span class="s8">).</span><span class="s4">textContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'Error: Database connection not ready.'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalGrossInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'totalGross'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalGross </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">totalGrossInput</span><span class="s8">.</span><span class="s1">value</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> invoiceNumber </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'invoiceNumber'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> dateValue </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'invoiceDate'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isNaN</span><span class="s8">(</span><span class="s1">totalGross</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> totalGross </span><span class="s8">&lt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">invoiceNumber </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">dateValue</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s4">getElementById</span><span class="s8">(</span><span class="s1">'status-message'</span><span class="s8">).</span><span class="s4">textContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'Please fill out all fields correctly.'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'status-message'</span><span class="s8">).</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text-red-500 font-bold mt-2'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// VAT Calculations (UK Standard Rate 20%)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> standardVATRate </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0.20</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Original Price (Net) = Gross / 1.2</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> netPrice </span><span class="s8">=</span><span class="s1"> totalGross </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s14">1</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> standardVATRate</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 20% VAT component of the Gross price</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> standardVATAmount </span><span class="s8">=</span><span class="s1"> totalGross </span><span class="s8">*</span><span class="s1"> </span><span class="s8">(</span><span class="s1">standardVATRate </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s14">1</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> standardVATRate</span><span class="s8">));</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Flat Rate Scheme (FRS) Calculations (10.5% of gross turnover)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> flatRatePercent </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0.105</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> hmrcFlatRateAmount </span><span class="s8">=</span><span class="s1"> totalGross </span><span class="s8">*</span><span class="s1"> flatRatePercent</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// PCW Retained Profit (VAT retained by business)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> pcwRetainedVat </span><span class="s8">=</span><span class="s1"> standardVATAmount </span><span class="s8">-</span><span class="s1"> hmrcFlatRateAmount</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Final PCW Amount = Net Price + PCW Retained VAT</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> finalPcwAmount </span><span class="s8">=</span><span class="s1"> netPrice </span><span class="s8">+</span><span class="s1"> pcwRetainedVat</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> newInvoice </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>invoiceNumber</span><span class="s8">:</span><span class="s1"> invoiceNumber</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>date</span><span class="s8">:</span><span class="s1"> dateValue</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalPrice</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">totalGross</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)),</span><span class="s1"> </span><span class="s13">// Gross (Number)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>netPrice</span><span class="s8">:</span><span class="s1"> netPrice</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">),</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>vat20Percent</span><span class="s8">:</span><span class="s1"> standardVATAmount</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>hmrcFlatRateAmount</span><span class="s8">:</span><span class="s1"> hmrcFlatRateAmount</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pcwRetainedVat</span><span class="s8">:</span><span class="s1"> pcwRetainedVat</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>finalPcwAmount</span><span class="s8">:</span><span class="s1"> finalPcwAmount</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">),</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>timestamp</span><span class="s8">:</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">dateValue</span><span class="s8">),</span><span class="s1"> </span><span class="s13">// Use a Date object for range queries</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>createdAt</span><span class="s8">:</span><span class="s1"> serverTimestamp</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Save to Firestore</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> addDoc</span><span class="s8">(</span><span class="s1">vatRecordsRef</span><span class="s8">,</span><span class="s1"> newInvoice</span><span class="s8">);</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Push to Google Sheet (Async, runs in the background)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> sheetData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>invoiceNumber</span><span class="s8">:</span><span class="s1"> invoiceNumber</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>date</span><span class="s8">:</span><span class="s1"> dateValue</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalPrice</span><span class="s8">:</span><span class="s1"> newInvoice</span><span class="s8">.</span><span class="s1">totalPrice</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">),</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>netPrice</span><span class="s8">:</span><span class="s1"> newInvoice</span><span class="s8">.</span><span class="s1">netPrice</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>vat20Percent</span><span class="s8">:</span><span class="s1"> newInvoice</span><span class="s8">.</span><span class="s1">vat20Percent</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>hmrcFlatRateAmount</span><span class="s8">:</span><span class="s1"> newInvoice</span><span class="s8">.</span><span class="s1">hmrcFlatRateAmount</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pcwRetainedVat</span><span class="s8">:</span><span class="s1"> newInvoice</span><span class="s8">.</span><span class="s1">pcwRetainedVat</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>finalPcwAmount</span><span class="s8">:</span><span class="s1"> newInvoice</span><span class="s8">.</span><span class="s1">finalPcwAmount</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>pushToGoogleSheet</span><span class="s8">(</span><span class="s1">sheetData</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'invoiceForm'</span><span class="s8">).</span><span class="s1">reset</span><span class="s8">();</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s4">getElementById</span><span class="s8">(</span><span class="s1">'status-message'</span><span class="s8">).</span><span class="s4">textContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'Invoice saved to database and sent to Google Sheet API!'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'status-message'</span><span class="s8">).</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text-green-500 font-bold mt-2'</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error saving invoice: "</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s4">getElementById</span><span class="s8">(</span><span class="s1">'status-message'</span><span class="s8">).</span><span class="s4">textContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'Error saving invoice. Check console for details.'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'status-message'</span><span class="s8">).</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text-red-500 font-bold mt-2'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Real-time listener and UI update function</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">setupRealtimeListener </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">filter </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'all'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">vatRecordsRef</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Get the reference date from the input field</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> referenceDateString </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'filterDate'</span><span class="s8">)?.</span><span class="s1">value </span><span class="s8">||</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> range </span><span class="s8">=</span><span class="s1"> getDateRange</span><span class="s8">(</span><span class="s1">filter</span><span class="s8">,</span><span class="s1"> referenceDateString</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Note: Firestore does not support combining range queries (timestamp &gt;=) and orderBy()<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// without composite indexes, so we filter by date range if applicable and sort client-side.</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> filterQuery </span><span class="s8">=</span><span class="s1"> vatRecordsRef</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">filter </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'all'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                 </span></span><span class="s1">// Use range query for date filtering</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span>filterQuery </span><span class="s8">=</span><span class="s1"> query</span><span class="s8">(</span><span class="s1">vatRecordsRef</span><span class="s8">,</span><span class="s1"> where</span><span class="s8">(</span><span class="s9">'timestamp'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'&gt;='</span><span class="s8">,</span><span class="s1"> range</span><span class="s8">.</span><span class="s1">startDate</span><span class="s8">),</span><span class="s1"> where</span><span class="s8">(</span><span class="s9">'timestamp'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'&lt;'</span><span class="s8">,</span><span class="s1"> range</span><span class="s8">.</span><span class="s1">endDate</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// We do not use orderBy() in the query to avoid potential index errors and instead sort client-side.</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> unsubscribe </span><span class="s8">=</span><span class="s1"> onSnapshot</span><span class="s8">(</span><span class="s1">filterQuery</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">snapshot</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalHMRC </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalPCW </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalGross </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> invoiceTableBody </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'invoiceTableBody'</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>invoiceTableBody</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;tr id="loading-row"&gt;&lt;td colspan="8" class="text-center py-4 text-gray-500"&gt;Loading records...&lt;/td&gt;&lt;/tr&gt;'</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> allInvoices </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>snapshot</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">doc</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>allInvoices</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> doc</span><span class="s8">.</span><span class="s1">id</span><span class="s8">,</span><span class="s1"> </span><span class="s8">...</span><span class="s1">doc</span><span class="s8">.</span><span class="s1">data</span><span class="s8">()</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Clear the loading message once data is fetched (even if empty)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>invoiceTableBody</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// --- SORTING LOGIC: Invoice Number (Ascending) then Date (Descending/Newest First) ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>allInvoices</span><span class="s8">.</span><span class="s1">sort</span><span class="s8">((</span><span class="s1">a</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// 1. Primary Sort: Invoice Number (Ascending) - Case Insensitive</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> numA </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">a</span><span class="s8">.</span><span class="s1">invoiceNumber </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">).</span><span class="s1">toUpperCase</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> numB </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">b</span><span class="s8">.</span><span class="s1">invoiceNumber </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">).</span><span class="s1">toUpperCase</span><span class="s8">();</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">numA </span><span class="s8">&lt;</span><span class="s1"> numB</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">-</span><span class="s14">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">numA </span><span class="s8">&gt;</span><span class="s1"> numB</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">return</span><span class="s1"> </span><span class="s14">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// 2. Secondary Sort: Date/Timestamp (Descending - newest first)</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Convert Firestore Timestamps or date strings to Date objects for comparison</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> dateA </span><span class="s8">=</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">timestamp </span><span class="s8">?</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">timestamp</span><span class="s8">.</span><span class="s1">toDate</span><span class="s8">()</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s8">(</span><span class="s1">a</span><span class="s8">.</span><span class="s1">date </span><span class="s8">?</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">a</span><span class="s8">.</span><span class="s1">date</span><span class="s8">)</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s14">0</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> dateB </span><span class="s8">=</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">timestamp </span><span class="s8">?</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">timestamp</span><span class="s8">.</span><span class="s1">toDate</span><span class="s8">()</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s8">(</span><span class="s1">b</span><span class="s8">.</span><span class="s1">date </span><span class="s8">?</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s1">b</span><span class="s8">.</span><span class="s1">date</span><span class="s8">)</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">(</span><span class="s14">0</span><span class="s8">));</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Descending sort (B - A)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1"> dateB</span><span class="s8">.</span><span class="s1">getTime</span><span class="s8">()</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> dateA</span><span class="s8">.</span><span class="s1">getTime</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// --- END SORTING LOGIC ---</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">allInvoices</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s14">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                     </span>invoiceTableBody</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;tr id="no-records-row"&gt;&lt;td colspan="8" class="text-center py-4 text-gray-500"&gt;No records found for this period.&lt;/td&gt;&lt;/tr&gt;'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>allInvoices</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">invoice</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> data </span><span class="s8">=</span><span class="s1"> invoice</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Ensure parsing only happens if data exists and is a valid number string</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> hmrc </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">data</span><span class="s8">.</span><span class="s1">hmrcFlatRateAmount </span><span class="s8">||</span><span class="s1"> </span><span class="s14">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> pcw </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">data</span><span class="s8">.</span><span class="s1">pcwRetainedVat </span><span class="s8">||</span><span class="s1"> </span><span class="s14">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> gross </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">data</span><span class="s8">.</span><span class="s1">totalPrice </span><span class="s8">||</span><span class="s1"> </span><span class="s14">0</span><span class="s8">);</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalHMRC </span><span class="s8">+=</span><span class="s1"> hmrc</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalPCW </span><span class="s8">+=</span><span class="s1"> pcw</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalGross </span><span class="s8">+=</span><span class="s1"> gross</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> row </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'tr'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>row</span><span class="s8">.</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'border-b hover:bg-gray-50'</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> formattedDate </span><span class="s8">=</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">timestamp<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">?</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">timestamp</span><span class="s8">.</span><span class="s1">toDate</span><span class="s8">().</span><span class="s1">toLocaleDateString</span><span class="s8">(</span><span class="s9">'en-GB'</span><span class="s8">)</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">:</span><span class="s1"> </span><span class="s8">(</span><span class="s1">data</span><span class="s8">.</span><span class="s1">date </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'N/A'</span><span class="s8">);</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>row</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm"&gt;</span><span class="s8">${</span><span class="s4">formattedDate</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm"&gt;</span><span class="s8">${</span><span class="s4">data</span><span class="s8">.</span><span class="s4">invoiceNumber </span><span class="s8">||</span><span class="s4"> </span><span class="s1">'N/A'</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm text-right"&gt;£</span><span class="s8">${</span><span class="s4">parseFloat</span><span class="s8">(</span><span class="s4">data</span><span class="s8">.</span><span class="s4">netPrice</span><span class="s8">).</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm text-right"&gt;£</span><span class="s8">${</span><span class="s4">gross</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm text-right text-green-600"&gt;£</span><span class="s8">${</span><span class="s4">parseFloat</span><span class="s8">(</span><span class="s4">data</span><span class="s8">.</span><span class="s4">vat20Percent</span><span class="s8">).</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm text-right text-red-600"&gt;£</span><span class="s8">${</span><span class="s4">hmrc</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm text-right text-blue-600"&gt;£</span><span class="s8">${</span><span class="s4">pcw</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="py-2 px-4 text-sm text-right font-bold text-indigo-700"&gt;£</span><span class="s8">${</span><span class="s4">parseFloat</span><span class="s8">(</span><span class="s4">data</span><span class="s8">.</span><span class="s4">finalPcwAmount</span><span class="s8">).</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>invoiceTableBody</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">row</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Update Summary Cards</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-hmrc'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`£</span><span class="s8">${</span><span class="s1">totalHMRC</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pcw'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`£</span><span class="s8">${</span><span class="s1">totalPCW</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-gross'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`£</span><span class="s8">${</span><span class="s1">totalGross</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'records-count'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> allInvoices</span><span class="s8">.</span><span class="s1">length</span><span class="s8">;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Update filter button styles</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.filter-btn'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">btn </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Check if the button ID matches the current filter</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">btn</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> </span><span class="s9">`</span><span class="s8">${</span><span class="s1">filter</span><span class="s8">}</span><span class="s9">-filter`</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>btn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>btn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">},</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Firestore onSnapshot error:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s4">getElementById</span><span class="s8">(</span><span class="s1">'invoiceTableBody'</span><span class="s8">).</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;tr id="error-row"&gt;&lt;td colspan="8" class="text-center py-4 text-red-500"&gt;Error loading records. See console.&lt;/td&gt;&lt;/tr&gt;'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Cleanup function returned for potential future use, though not strictly needed here</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> unsubscribe</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Helper to handle date change and re-run filter</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">handleDateChange </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">// Find the currently active filter button</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> activeBtn </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'.filter-btn.active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">activeBtn</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> currentFilter </span><span class="s8">=</span><span class="s1"> activeBtn</span><span class="s8">.</span><span class="s1">id</span><span class="s8">.</span><span class="s1">replace</span><span class="s8">(</span><span class="s9">'-filter'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>window</span><span class="s8">.</span><span class="s1">setupRealtimeListener</span><span class="s8">(</span><span class="s1">currentFilter</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">initFirebase</span><span class="s8">();</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 sm:p-8"</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"max-w-4xl mx-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl sm:text-4xl font-extrabold text-gray-800 mb-6 text-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>PCW Flat Rate VAT Manager</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"user-id"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm text-gray-500 mb-6 text-center"</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- New Invoice Entry Form --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container-card mb-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xl font-semibold mb-4 text-gray-700"</span><span class="s3">&gt;</span><span class="s1">Record New Invoice (FRS 10.5%)</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">form</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"invoiceForm"</span><span class="s4"> </span><span class="s2">onsubmit</span><span class="s3">=</span><span class="s1">"saveInvoice(event)"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 sm:grid-cols-4 gap-4 items-end"</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"invoiceNumber"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-700 mb-1"</span><span class="s3">&gt;</span><span class="s4">Invoice No.</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Force consistent height --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"invoiceNumber"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"INV-001"</span><span class="s4"> </span><span class="s2">required</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"input-style w-full h-10"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"invoiceDate"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-700 mb-1"</span><span class="s3">&gt;</span><span class="s4">Date</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Force consistent height --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"date"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"invoiceDate"</span><span class="s4"> </span><span class="s2">required</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"input-style w-full h-10"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"totalGross"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-700 mb-1"</span><span class="s3">&gt;</span><span class="s4">Total Price (Gross £)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Force consistent height --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"totalGross"</span><span class="s4"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"120.00"</span><span class="s4"> </span><span class="s2">required</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"input-style w-full h-10"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"submit"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn-primary w-full sm:w-auto"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>Add Invoice</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">form</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"status-message"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 text-center"</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Summary &amp; Filter Controls --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container-card mb-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold mb-4 text-gray-700"</span><span class="s3">&gt;</span><span class="s4">Summary Totals</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Date Input --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col sm:flex-row justify-center items-center gap-4 mb-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"filterDate"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm font-medium text-gray-700 whitespace-nowrap"</span><span class="s3">&gt;</span><span class="s4">Filter **Reference Date**:</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"date"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"filterDate"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"input-style w-full sm:w-auto"</span><span class="s4"> </span><span class="s2">onchange</span><span class="s3">=</span><span class="s1">"handleDateChange()"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Filter Buttons --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-wrap justify-center gap-2 mb-6"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"daily-filter"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"setupRealtimeListener('daily')"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"filter-btn"</span><span class="s3">&gt;</span><span class="s4">Daily</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"weekly-filter"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"setupRealtimeListener('weekly')"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"filter-btn"</span><span class="s3">&gt;</span><span class="s4">Weekly</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"monthly-filter"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"setupRealtimeListener('monthly')"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"filter-btn active"</span><span class="s3">&gt;</span><span class="s4">Monthly</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"yearly-filter"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"setupRealtimeListener('yearly')"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"filter-btn"</span><span class="s3">&gt;</span><span class="s4">Yearly</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"all-filter"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"setupRealtimeListener('all')"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"filter-btn"</span><span class="s3">&gt;</span><span class="s4">All Time</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Summary Cards --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-3 gap-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"summary-box"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm font-medium text-gray-600"</span><span class="s3">&gt;</span><span class="s1">Total VAT to pay to HMRC (10.5%)</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"total-hmrc"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-red-700 mt-1"</span><span class="s3">&gt;</span><span class="s4">£0.00</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs text-gray-500 mt-1"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"records-count-hmrc"</span><span class="s3">&gt;</span><span class="s4">VAT payable based on </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"records-count"</span><span class="s3">&gt;</span><span class="s4">0</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s4"> records.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"summary-box border-left-4 border-green-500"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm font-medium text-gray-600"</span><span class="s3">&gt;</span><span class="s1">Total VAT Retained (PCW Profit)</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"total-pcw"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-green-700 mt-1"</span><span class="s3">&gt;</span><span class="s4">£0.00</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500 mt-1"</span><span class="s3">&gt;</span><span class="s1">Total VAT profit (20% VAT - 10.5% FRS)</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"summary-box border-left-4 border-gray-500"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm font-medium text-gray-600"</span><span class="s3">&gt;</span><span class="s1">Total Gross Turnover</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"total-gross"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-gray-800 mt-1"</span><span class="s3">&gt;</span><span class="s4">£0.00</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500 mt-1"</span><span class="s3">&gt;</span><span class="s1">Sum of all invoice gross totals.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Invoice List --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container-card overflow-x-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold mb-4 text-gray-700"</span><span class="s3">&gt;</span><span class="s4">Invoice Records</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">table</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"min-w-full divide-y divide-gray-200"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">thead</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"bg-gray-50"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Date</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Invoice No.</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Net Price (£)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Gross (£)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">20% VAT</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">HMRC FRS (10.5%)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">PCW Retained</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Final PCW (£)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">thead</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">tbody</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"invoiceTableBody"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white divide-y divide-gray-200"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Invoice rows will be inserted here by JavaScript --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"loading-row"</span><span class="s3">&gt;&lt;</span><span class="s6">td</span><span class="s4"> </span><span class="s2">colspan</span><span class="s3">=</span><span class="s1">"8"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center py-4 text-gray-500"</span><span class="s3">&gt;</span><span class="s4">Loading records...</span><span class="s3">&lt;/</span><span class="s6">td</span><span class="s3">&gt;&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">tbody</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">table</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
